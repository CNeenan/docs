---
title: v21.1 Patch Releases
toc: true
summary: Additions and changes in v21.1 patch releases
toc_not_nested: true
---

## v21.1.9

- For a comprehensive summary of features in v21.1, see the [v21.1 GA release notes](v21.1.0.html).
- To upgrade to v21.1, see [Upgrade to CockroachDB v21.1](../v21.1/upgrade-cockroach-version.html).

Get future release notes emailed to you:

{% include marketo.html %}

### Downloads

<div id="os-tabs" class="filters clearfix">
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.9.linux-amd64.tgz"><button id="linux" class="filter-button" data-scope="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.9.darwin-10.9-amd64.tgz"><button id="mac" class="filter-button" data-scope="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.9.windows-6.2-amd64.zip"><button id="windows" class="filter-button" data-scope="windows" data-eventcategory="windows-binary-release-notes">Windows</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.9.src.tgz"><button id="source" class="filter-button" data-scope="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

<section class="filter-content" data-scope="windows">
{% include windows_warning.md %}
</section>

### Docker image

{% include copy-clipboard.html %}
~~~shell
$ docker pull cockroachdb/cockroach:v21.1.9
~~~

### SQL language changes

- Added the [`bulkio.backup.proxy_file_writes.enabled`](../v21.1/cluster-settings.html) cluster setting to opt-in to writing backup files outside the KV storage layer. [#69250][#69250]
- You can now alter the owner of the `crdb_internal_region` type which is created by initiating a [multi-region database](../v21.1/multiregion-overview.html). [#69759][#69759]

### Operational changes

- A new cluster setting, [`sql.mutations.max_row_size.log`](../v21.1/cluster-settings.html), was added, which controls large row logging. Whenever a row larger than this size is written (or a single column family if multiple column families are in use) a `LargeRow` event is logged to the `SQL_PERF` channel (or a `LargeRowInternal` event is logged to `SQL_INTERNAL_PERF` if the row was added by an internal query). This could occur for `INSERT`, `UPSERT`, `UPDATE`, `CREATE TABLE AS`, `CREATE INDEX`, `ALTER TABLE`, `ALTER INDEX`, `IMPORT`, or `RESTORE` statements. `SELECT`, `DELETE`, `TRUNCATE`, and `DROP` are not affected by this setting. This setting is disabled by default. [#69946][#69946]
- A new cluster setting, [`sql.mutations.max_row_size.err`](../v21.1/cluster-settings.html), was added, which limits the size of rows written to the database (or individual column families, if multiple column families are in use). Statements trying to write a row larger than this will fail with a code 54000 (`program_limit_exceeded`) error. Internal queries writing a row larger than this will not fail, but will log a `LargeRowInternal` event to the `SQL_INTERNAL_PERF` channel. This limit is enforced for `INSERT`, `UPSERT`, and `UPDATE` statements. `CREATE TABLE AS`, `CREATE INDEX`, `ALTER TABLE`, `ALTER INDEX`, `IMPORT`, and `RESTORE` will not fail with an error, but will log `LargeRowInternal` events to the `SQL_INTERNAL_PERF` channel. `SELECT`, `DELETE`, `TRUNCATE`, and `DROP` are not affected by this limit. Note that existing rows violating the limit *cannot* be updated, unless the update shrinks the size of the row below the limit, but *can* be selected, deleted, altered, backed-up, and restored. For this reason we recommend using the accompanying setting `sql.mutations.max_row_size.log` in conjunction with `SELECT pg_column_size()` queries to detect and fix any existing large rows before lowering `sql.mutations.max_row_size.err`. This setting is disabled by default. [#69946][#69946]
- New variables `sql.mutations.max_row_size.{log|err}` were renamed to `sql.guardrails.max_row_size_{log|err}` for consistency with other variables and metrics. [#69946][#69946]
- Added four new metrics: `sql.guardrails.max_row_size_log.count`, `sql.guardrails.max_row_size_log.count.internal`, `sql.guardrails.max_row_size_err.count`, and `sql.guardrails.max_row_size_err.count.internal`. These metrics are incremented whenever a large row violates the corresponding `sql.guardrails.max_row_size_{log|err}` limit. [#69946][#69946]

### DB Console changes

- A CES survey link component was added to support being able to get client feedback. [#68517][#68517]

### Bug fixes

- Fixed a bug where running [`IMPORT PGDUMP`](../v21.1/migrate-from-postgres.html) with a UDT would result in a null pointer exception. This change makes it fail gracefully. [#69249][#69249]
- Fixed a bug where the `schedules.backup.succeeded` and `schedules.backup.failed` metrics would sometimes not be updated. [#69256][#69256]
- The correct format code will now be returned when using [`COPY FROM .. BINARY`](../v21.1/copy-from.html). [#69278][#69278]
- Fixed a bug where [`COPY FROM ... BINARY`](../v21.1/copy-from.html) would return an error if the input data was split across different messages. [#69278][#69278]
- Fixed a bug where [`COPY FROM ... CSV`](../v21.1/copy-from.html) would require each `CopyData` message to be split at the boundary of a record. The `COPY` protocol allows messages to be split at arbitrary points. [#69278][#69278]
- Fixed a bug where [`COPY FROM ... CSV`](../v21.1/copy-from.html) did not correctly handle octal byte escape sequences such as `\011` when using a [`BYTES` column](../v21.1/bytes.html). [#69278][#69278]
- Fixed an oversight in the data generator for TPC-H which was causing a smaller number of distinct values to be generated for p_type and p_container in the part table than the spec calls for. [#68710][#68710]
- Fixed a bug that was introduced in [v21.1.5](v21.1.5.html), which prevented [nodes from being decommissioned](../v21.1/remove-nodes.html) in a cluster if the cluster had multiple nodes intermittently miss their liveness heartbeat. [#68552][#68552]
- Fixed a bug introduced in v21.1 where CockroachDB could return an internal error when performing streaming aggregation in some edge cases. [#69181][#69181]
- Fixed a bug that created non-partial unique constraints when a user attempted to create a partial unique constraint in [`ALTER TABLE` statements](../v21.1/alter-table.html). [#68745][#68745]
- Fixed a bug where a [`DROP VIEW ... CASCADE`](../v21.1/drop-view.html) could incorrectly result in "table ...is already being dropped" errors. [#68618][#68618]
- Fixed a bug introduced in v21.1 where the output of [`SHOW CREATE TABLE`](../v21.1/show-create.html) on tables with [hash-sharded indexes](../v21.1/hash-sharded-indexes.html) was not round-trippable. Executing the output would not create an identical table. This has been fixed by showing `CHECK` constraints that are automatically created for these indexes in the output of `SHOW CREATE TABLE`. [#69695][#69695]
- Fixed internal or "invalid cast" error in some cases involving cascading [updates](../v21.1/update.html). [#69180][#69180]
- Fixed a bug with cardinality estimation in the [optimizer](../v21.1/cost-based-optimizer.html) that was introduced in v21.1.0. This bug could cause inaccurate row count estimates in queries involving tables with a large number of null values. As a result, it was possible that the optimizer could choose a suboptimal plan. [#69125][#69125]
- Fixed a bug introduced in v20.2 that caused internal errors with set operations, like [`UNION`](../v21.1/selection-queries.html#union-combine-two-queries), and columns with tuple types that contained constant `NULL` values. [#69271][#69271]
- Added backwards compatibility between v21.1.x cluster versions and the [v21.1.8 cluster version](v21.1.8.html). [#69894][#69894]
- Fixed a bug where table stats collection issued via [`EXPLAIN ANALYZE`](../v21.1/explain-analyze.html) statements or via [`CREATE STATISTICS`](../v21.1/create-statistics.html) statements without specifying the [`AS OF SYSTEM TIME`](../v21.1/as-of-system-time.html) option could run into `flow: memory budget exceeded`. [#69588][#69588]
- Fixed a bug where an internal error or a crash could occur when some [`crdb_internal` built-in functions](../v21.1/functions-and-operators.html) took string-like type arguments (e.g. `name`). [#69993][#69993]
- Fixed all broken links to the documentation from the DB Console. [#70117][#70117]
- Previously, when using [`ALTER PRIMARY KEY`](../v21.1/alter-primary-key.html) on a [`REGIONAL BY ROW`](../v21.1/multiregion-overview.html) table, the copied unique index from the old primary key would not have the correct [zone configurations](../v21.1/configure-zone.html) applied. This bug is now fixed. Users who have encountered this bug should re-create the index. [#69681][#69681]

### Performance improvements

- Lookup joins on [partial indexes](../v21.1/partial-indexes.html) with [virtual computed columns](../v21.1/computed-columns.html) are not considered by the [optimizer](../v21.1/cost-based-optimizer.html), resulting in more efficient query plans in some cases. [#69110][#69110]
- Updated the [optimizer](../v21.1/cost-based-optimizer.html) cost model so that, all else being equal, the optimizer prefers plans in which [`LIMIT`](../v21.1/limit-offset.html) operators are pushed as far down the tree as possible. This can reduce the number of rows that need to be processed by higher operators in the plan tree, improving performance.[#69977][#69977]

### Contributors

This release includes 40 merged PRs by 19 authors.

[#68509]: https://github.com/cockroachdb/cockroach/pull/68509
[#68517]: https://github.com/cockroachdb/cockroach/pull/68517
[#68552]: https://github.com/cockroachdb/cockroach/pull/68552
[#68618]: https://github.com/cockroachdb/cockroach/pull/68618
[#68710]: https://github.com/cockroachdb/cockroach/pull/68710
[#68745]: https://github.com/cockroachdb/cockroach/pull/68745
[#69110]: https://github.com/cockroachdb/cockroach/pull/69110
[#69125]: https://github.com/cockroachdb/cockroach/pull/69125
[#69180]: https://github.com/cockroachdb/cockroach/pull/69180
[#69181]: https://github.com/cockroachdb/cockroach/pull/69181
[#69249]: https://github.com/cockroachdb/cockroach/pull/69249
[#69250]: https://github.com/cockroachdb/cockroach/pull/69250
[#69256]: https://github.com/cockroachdb/cockroach/pull/69256
[#69271]: https://github.com/cockroachdb/cockroach/pull/69271
[#69278]: https://github.com/cockroachdb/cockroach/pull/69278
[#69305]: https://github.com/cockroachdb/cockroach/pull/69305
[#69588]: https://github.com/cockroachdb/cockroach/pull/69588
[#69695]: https://github.com/cockroachdb/cockroach/pull/69695
[#69759]: https://github.com/cockroachdb/cockroach/pull/69759
[#69894]: https://github.com/cockroachdb/cockroach/pull/69894
[#69946]: https://github.com/cockroachdb/cockroach/pull/69946
[#69977]: https://github.com/cockroachdb/cockroach/pull/69977
[#69993]: https://github.com/cockroachdb/cockroach/pull/69993
[#70117]: https://github.com/cockroachdb/cockroach/pull/70117
[#69681]: https://github.com/cockroachdb/cockroach/pull/69681

## v21.1.8

{{site.data.alerts.callout_danger}}
This patch release has been withdrawn due to [this technical advisory](../advisories/a69874.html). All the changes listed as part of this release will be in the next release. Do not upgrade to this release.
{{site.data.alerts.end}}

- For a comprehensive summary of features in v21.1, see the [v21.1 GA release notes](v21.1.0.html).
- To upgrade to v21.1, see [Upgrade to CockroachDB v21.1](../v21.1/upgrade-cockroach-version.html).

Get future release notes emailed to you:

{% include marketo.html %}

### Downloads and Docker image

{{site.data.alerts.callout_danger}}
This release was withdrawn, and we've removed the links to the downloads and Docker image.
{{site.data.alerts.end}}

### Security updates

- The [node status retrieval endpoints over HTTP](../v21.1/monitoring-and-alerting.html) (`/_status/nodes`, `/_status/nodes/<N>`, and the DB Console `/#/reports/nodes`) have been updated to require the [`admin`](../v21.1/authorization.html#admin-role) role from the requesting user. This ensures that operational details such as network addresses and command-line flags do not leak to unprivileged users. [#67068][#67068] {% comment %}doc{% endcomment %}

### General changes

- A recent release removed parts of some queries from the [debugging traces](../v21.1/show-trace.html) of those queries. This information (i.e. the execution of some low-level RPCs) has been re-included in the traces. [#68923][#68923] {% comment %}doc{% endcomment %}

### Enterprise edition changes

- The `kafka_sink_config` [changefeed option](../v21.1/create-changefeed.html) can now include `RequiredAcks`. [#69015][#69015] {% comment %}doc{% endcomment %}
- Added a new per-node [changefeed](../v21.1/stream-data-out-of-cockroachdb-using-changefeeds.html) configuration [`changefeed.node_sink_throttle_config`](../v21.1/cluster-settings.html) that can be used to throttle the rate of emission from the memory buffer thus making it possible to limit the emission rate from changefeeds. [#68628][#68628] {% comment %}doc{% endcomment %}

### SQL language changes

- Added a new [`EXPLAIN` flag](../v21.1/explain.html), `MEMO`, to be used with [`EXPLAIN (OPT)`](../v21.1/explain.html#opt-option). When the `MEMO` flag is passed, a representation of the optimizer memo will be printed along with the best plan. The `MEMO` flag can be used in combination with other flags such as `CATALOG` and `VERBOSE`. For example, `EXPLAIN (OPT, MEMO, VERBOSE)` will print the memo along with verbose output for the best plan. [#67778][#67775] {% comment %}doc{% endcomment %}
- Some queries with [lookup joins](../v21.1/joins.html#lookup-joins) and/or top K sorts are now more likely to be executed in a "local" manner with the [`distsql=auto`](../v21.1/set-vars.html#parameters) session variable when the newly introduced `sql.distsql.prefer_local_execution.enabled` [cluster setting](../v21.1/cluster-settings.html) is set to `true` (`false` is the default). [#68613][#68613] {% comment %}doc{% endcomment %}

### Operational changes

- Introduced the `bulkio.index_backfill.checkpoint_interval` [cluster setting](../v21.1/cluster-settings.html) to control the rate at which backfills checkpoint their progress. Useful for controlling the backfill rate on large tables. [#68287][#68287] {% comment %}doc{% endcomment %}

### Command-line changes

- [`cockroach debug zip`](../v21.1/cockroach-debug-zip.html) no longer retrieves database and table details into separate files. The schema information is collected by means of `system.descriptors` and `crdb_internal.create_statements`. [#68984][#68984] {% comment %}doc{% endcomment %}

### DB Console changes

- Added a new column picker on the [Statements](../v21.2/ui-statements-page.html) and [Statements Details pages](../v21.1/ui-statements-page.html#statement-details-page) to select which columns to display in the statements table. Includes a new database column option for database name information, which is hidden by default on the [Statements page](../v21.2/ui-statements-page.html). [#68294][#68294] {% comment %}doc{% endcomment %}
- Fixed the [Transactions page](../v21.2/ui-transactions-page.html) to show the correct value for implicit transactions. [#68294][#68294]
- [Statements Details](../v21.1/ui-statements-page.html#statement-details-page), [Statements](../v21.2/ui-statements-page.html), and [Transactions pages](../v21.2/ui-transactions-page.html) now display information about the node and region on which a statement was executed. [#68317][#68317] {% comment %}doc{% endcomment %}
- Fixed tooltips behavior on the [Sessions](../v21.2/ui-sessions-page.html), [Statements](../v21.2/ui-statements-page.html), and [Transactions pages](../v21.2/ui-transactions-page.html). [#68474][#68474] {% comment %}doc{% endcomment %}

### Bug fixes

- Fixed missing [foreign key](../v21.1/foreign-key.html) checks in some cases when there are multiple checks and the inserted data contains a `NULL` for one of the checks. [#68520][#68520]
- Fixed a bug where using [`ST_segmentize`](../v21.1/functions-and-operators.html#spatial-functions) on coordinates that are infinite would error with a crash. [#67848][#67848]
- Fixed the [`COPY CSV`](../v21.1/copy-from.html) command so that it handles multiple records separated by newline characters. [#68623][#68623] {% comment %}doc{% endcomment %}
- Fixed a bug that caused incorrect query results when querying tables with multiple [column families](../v21.1/column-families.html) and unique secondary [indexes](../v21.1/indexes.html). The bug only occurred if 1) [vectorized execution](../v21.1/vectorized-execution.html) was enabled for the query, 2) the query scanned a [unique secondary index](../v21.1/indexes.html) that contained columns from more than one column family, and 3) the rows fetched by the query contained `NULL` values for some of the indexed columns. This bug was present since version v20.1. [#68238][#68239]
- Fixed a crash in the `/debug/closedts-{sender,receiver}` [advanced debug pages](../v21.1/ui-debug-pages.html) if the last message of the closed timestamp side transport buffer was removed before rendering. [#68669][#68669]
- Fixed an issue where terminating a CockroachDB process early in its startup routine might cause it to fail to start again, falsely reporting write-ahead log corruption. [#68897][#68897]
- Fixed a regression in the [optimizer's cost model](../v21.1/cost-based-optimizer.html) that could cause it to choose sub-optimal plans when choosing between two non-unique index scans with different numbers of columns per index. [#68991][#68991]
- Fixed a bug where CockroachDB could incorrectly evaluate [`LIKE` expressions](../v21.1/scalar-expressions.html#string-pattern-matching) when the pattern contained the escape characters `\` if the expressions were executed via the [vectorized execution engine](../v21.1/vectorized-execution.html). [#68353][#68353]
- File logs now respect the [`max-group-size`](../v21.1/configure-logs.html) configuration parameter again. This parameter had incorrectly become ignored in v21.1, resulting in arbitrarily large log directories. [#69007][#69007]
- Fixed a bug in [`EXPORT`](../v21.1/export.html) where concurrent exports could overwrite each other. [#68392][#68392]

### Performance improvements

- Jobs no longer hold exclusive locks during the duration of their checkpointing transactions which could result in long wait times when trying to run [`SHOW JOBS`](../v21.1/show-jobs.html). [#68244][#68244] {% comment %}doc{% endcomment %}
- [Lookup joins](../v21.1/joins.html#lookup-joins) on indexes with virtual columns are now considered by the optimizer. This should result in more efficient queries in many cases. Most notably, post-query uniqueness checks for unique indexes on virtual columns in [`REGIONAL BY ROW` tables](../v21.1/regional-tables.html#regional-by-row-tables) can now use the unique index rather than perform a full-table scan. [#68423][#68423] {% comment %}doc{% endcomment %}

### Contributors

This release includes 40 merged PRs by 26 authors.

[#67068]: https://github.com/cockroachdb/cockroach/pull/67068
[#67746]: https://github.com/cockroachdb/cockroach/pull/67746
[#67775]: https://github.com/cockroachdb/cockroach/pull/67775
[#67848]: https://github.com/cockroachdb/cockroach/pull/67848
[#67883]: https://github.com/cockroachdb/cockroach/pull/67883
[#68239]: https://github.com/cockroachdb/cockroach/pull/68239
[#68244]: https://github.com/cockroachdb/cockroach/pull/68244
[#68287]: https://github.com/cockroachdb/cockroach/pull/68287
[#68294]: https://github.com/cockroachdb/cockroach/pull/68294
[#68317]: https://github.com/cockroachdb/cockroach/pull/68317
[#68353]: https://github.com/cockroachdb/cockroach/pull/68353
[#68392]: https://github.com/cockroachdb/cockroach/pull/68392
[#68423]: https://github.com/cockroachdb/cockroach/pull/68423
[#68474]: https://github.com/cockroachdb/cockroach/pull/68474
[#68510]: https://github.com/cockroachdb/cockroach/pull/68510
[#68520]: https://github.com/cockroachdb/cockroach/pull/68520
[#68613]: https://github.com/cockroachdb/cockroach/pull/68613
[#68623]: https://github.com/cockroachdb/cockroach/pull/68623
[#68628]: https://github.com/cockroachdb/cockroach/pull/68628
[#68669]: https://github.com/cockroachdb/cockroach/pull/68669
[#68897]: https://github.com/cockroachdb/cockroach/pull/68897
[#68923]: https://github.com/cockroachdb/cockroach/pull/68923
[#68984]: https://github.com/cockroachdb/cockroach/pull/68984
[#68991]: https://github.com/cockroachdb/cockroach/pull/68991
[#69007]: https://github.com/cockroachdb/cockroach/pull/69007
[#69015]: https://github.com/cockroachdb/cockroach/pull/69015

## v21.1.7

This page lists additions and changes in v21.1.7 since v21.1.6.

- For a comprehensive summary of features in v21.1, see the [v21.1 GA release notes](v21.1.0.html).
- To upgrade to v21.1, see [Upgrade to CockroachDB v21.1](../v21.1/upgrade-cockroach-version.html).

Get future release notes emailed to you:

{% include marketo.html %}

### Downloads

<div id="os-tabs" class="filters clearfix">
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.7.linux-amd64.tgz"><button id="linux" class="filter-button" data-scope="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.7.darwin-10.9-amd64.tgz"><button id="mac" class="filter-button" data-scope="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.7.windows-6.2-amd64.zip"><button id="windows" class="filter-button" data-scope="windows" data-eventcategory="windows-binary-release-notes">Windows</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.7.src.tgz"><button id="source" class="filter-button" data-scope="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

<section class="filter-content" data-scope="windows">
{% include windows_warning.md %}
</section>

### Docker image

{% include_cached copy-clipboard.html %}
~~~shell
$ docker pull cockroachdb/cockroach:v21.1.7
~~~

### Security updates

- The `--cert-principal-map` flag passed to [`cockroach` commands](../v21.1/cockroach-commands.html) now allows the certificate principal name to contain colons. [#67810][#67810] {% comment %}doc{% endcomment %}

### General changes

- Added a new [cluster setting](../v21.1/cluster-settings.html) (`kv.transaction.reject_over_max_intents_budget`) that controls the behavior of CockroachDB when a transaction exceeds the locks-tracking memory budget set by the `kv.transaction.max_intents_bytes` cluster setting. If `kv.transaction.reject_over_max_intents_budget` is set to `true`, CockroachDB rejects the query that would push its transaction over the memory budget with an error (error code 53400 - "configuration limit exceeded"). Transactions that don't track their locks precisely are potentially destabilizing for the cluster since cleaning up locks can take up considerable resources. Transactions that change many rows have the potential to run into this memory budget issue. [#67967][#67967] {% comment %}doc{% endcomment %}

### SQL language changes

- The remote [DistSQL](../v21.1/architecture/sql-layer.html#distsql) flows are now eagerly canceled if they were queued up and the query was canceled. [#66331][#66331]
- Added a new cluster setting (`changefeed.slow_span_log_threshold`) that allows setting a cluster-wide default for slow span logging. [#68106][#68106] {% comment %}doc{% endcomment %}
- Added a new [session variable](../v21.1/set-vars.html) (`enable_copying_partitioning_when_deinterleaving_table`) which will change the behavior of [`ALTER PRIMARY KEY`](../v21.1/alter-primary-key.html) when performing a change which retains the same primary key but removes an [`INTERLEAVE INTO` clause](../v21.1/interleave-in-parent.html). When this variable is set to `true` and an `ALTER PRIMARY KEY` is run that only removes an `INTERLEAVE INTO` clause, the [partitioning](../v21.1/partitioning.html) and [zone configuration](../v21.1/configure-zone.html) which applied to the root of the interleave will not be applied to the new primary index. The default value for `enable_copying_partitioning_when_deinterleaving_table` is equal to the value set for the new cluster setting `sql.defaults.copy_partitioning_when_deinterleaving_table.enabled`. [#68114][#68114] {% comment %}doc{% endcomment %}

### Operational changes

- [Histogram metrics](../v21.1/cost-based-optimizer.html#control-histogram-collection) now store the total number of observations over time. [#68106][#68106] {% comment %}doc{% endcomment %}

### DB Console changes

- Fixed a bug causing the Summary Panel on the [Overview Dashboard](../v21.1/ui-overview-dashboard.html) to flicker. [#67365][#67365]
- Fixed a bug preventing a redirect to the originally-requested DB Console page after user login. [#67858][#67858]
- User can now see time series metrics for disk spilling on the [Advanced Debug page](../v21.1/ui-debug-pages.html). [#68112][#68112] {% comment %}doc{% endcomment %}
- Fixed color mismatch of node status badge on the [Cluster Overview page](../v21.1/ui-cluster-overview-page.html). [#68056][#68056]
- Chart titles on the [Replication Dashboard](../v21.1/ui-replication-dashboard.html) were previously falsely labeled as "per Store" but were in fact "per Node". This bug is now fixed. [#67847][#67847] {% comment %}doc{% endcomment %}

### Bug fixes

- Fixed a bug causing the `ST_GeneratePoints` [built-in function](../v21.1/functions-and-operators.html) to return a garbage value or an error if an empty geometry or negative nPoints input is given. [#67580][#67580]
- Fixed a bug where [`DROP DATABASE`](../v21.1/drop-database.html) could return errors if the database contained [temporary views](../v21.1/views.html#temporary-views) in use in an another session. [#67172][#67172]
- Fixed a [storage-level](../v21.1/architecture/storage-layer.html) bug where Pebble would occasionally create excessively large SSTables, causing poor compaction performance and high read-amplification. This was especially likely after a manual offline compaction. [#67610][#67610]
- [Correlated subqueries](../v21.1/subqueries.html#correlated-subqueries) that couldn't be decorrelated and that have their own subqueries are now executed correctly when supported. Note that it is an edge case of an edge case, so it's unlikely that users have hit this bug (it was found by the randomized testing). [#67570][#67570]
- Fixed very rare, unexpected "index out of bounds" error from the [vectorized engine](../v21.1/vectorized-execution.html) when evaluating a `CASE` operator. [#67779][#67779]
- Catching up [Raft](../v21.1/architecture/replication-layer.html#raft) followers on the Raft log is now more efficient in the presence of many large Raft log entries. This helps avoid situations where Raft leaders struggle to retain leadership while catching up their followers. [#67127][#67127]
- Fixed a bug that allowed rows to be inserted into a table with a [`CHECK` constraint](../v21.1/check.html) that always evaluated to `false` (e.g., `CHECK (false)`). This bug was present since version 21.1.0. [#67341][#67341]
- Fixed a bug causing [changefeeds](../v21.1/changefeed-for.html) to sometimes get stuck. [#67968][#67968]
- Previously, CockroachDB nodes would crash whenever the cluster setting `sql.trace.txn.enable_threshold` was changed to a non-zero value. The bug was introduced in 21.1.0. [#68027][#68027]
- Fixed a deadlock that could occur when many replicas were rapidly queued for removal. [#65859][#65859]
- Fixed two bugs which affected [geospatial queries](../v21.1/spatial-features.html) with the `st_distance` function. The first bug caused errors for filters of the form `st_distance(g1, g2, use_spheroid) = 0`. The second could cause incorrect results in some cases; it incorrectly transformed filters of the form `st_distance(g1, g2) = 0` when `g1` and `g2` were geographies to `st_instersects(g1, g2)`. This is not a valid transformation because `st_distance` makes spheroid-based calculations by default while `st_intersects` only makes sphere-based calculations. [#67392][#67392]
- Fixed a bug causing a prepared statement to incorrectly reuse the query plan of a different prepared statement that had similar, but not identical type hints. [#67688][#67688]
- Fixed an issue with statistics estimation in the optimizer that could cause it to over-estimate the number of rows for some expressions and thus choose a sub-optimal plan. This issue could happen when multi-column statistics were used in combination with histograms, the query contained a predicate on two or more columns where the columns were highly correlated, and the selected values were very common according to the histograms. [#67998][#67998]
- Previously, CockroachDB could encounter an internal error or crash when performing a cast of [`NULL`](../v21.1/null-handling.html) [`JSON`](../v21.1/jsonb.html) value to [Geography or Geometry types](../v21.1/spatial-data.html). Now this is fixed. [#67902][#67902]
- [`INSERT`](../v21.1/insert.html) and [`UPDATE`](../v21.1/update.html) statements which operate on larger rows can now be split into batches using the `sql.mutations.mutation_batch_byte_size` setting. [#67958][#67958]
- A rare bug that could result in a crash while creating a [debug.zip file](../v21.1/cockroach-debug-zip.html) has been fixed. The bug was only possible to hit if a debug.zip file was captured during a period of rapid lease movement. [#67728][#67728]
- Previously the [`GRANT`](../v21.1/grant.html) and [`REVOKE`](../v21.1/revoke.html) commands would incorrectly handle role names. CockroachDB treats role names as case-insensitive, but these commands were incorrectly handling the names. Now, `GRANT` and `REVOKE` normalize the names and are case-insensitive. [#67901][#67901] {% comment %}doc{% endcomment %}

### Performance improvements

- [Vectorized flows](../v21.1/vectorized-execution.html) can use less memory when sending and receiving data to the network. [#67609][#67609]
- Range merges are no longer considered if a range has seen significant load over the previous 5 minutes, instead of being considered as long as a range had low load over the previous second. This change improves stability, as load-based splits will no longer rapidly disappear during transient throughput dips. [#65362][#65362]
- A new cluster setting `sql.defaults.optimizer_improve_disjunction_selectivity.enabled` enables more accurate selectivity estimation of query filters with `OR` expressions. This improves query plans in some cases. This cluster setting is disabled by default. [#67730][#67730] {% comment %}doc{% endcomment %}

### Contributors

This release includes 47 merged PRs by 26 authors.

[#65362]: https://github.com/cockroachdb/cockroach/pull/65362
[#65859]: https://github.com/cockroachdb/cockroach/pull/65859
[#66331]: https://github.com/cockroachdb/cockroach/pull/66331
[#67127]: https://github.com/cockroachdb/cockroach/pull/67127
[#67172]: https://github.com/cockroachdb/cockroach/pull/67172
[#67341]: https://github.com/cockroachdb/cockroach/pull/67341
[#67365]: https://github.com/cockroachdb/cockroach/pull/67365
[#67392]: https://github.com/cockroachdb/cockroach/pull/67392
[#67570]: https://github.com/cockroachdb/cockroach/pull/67570
[#67580]: https://github.com/cockroachdb/cockroach/pull/67580
[#67609]: https://github.com/cockroachdb/cockroach/pull/67609
[#67610]: https://github.com/cockroachdb/cockroach/pull/67610
[#67688]: https://github.com/cockroachdb/cockroach/pull/67688
[#67728]: https://github.com/cockroachdb/cockroach/pull/67728
[#67730]: https://github.com/cockroachdb/cockroach/pull/67730
[#67779]: https://github.com/cockroachdb/cockroach/pull/67779
[#67810]: https://github.com/cockroachdb/cockroach/pull/67810
[#67847]: https://github.com/cockroachdb/cockroach/pull/67847
[#67858]: https://github.com/cockroachdb/cockroach/pull/67858
[#67901]: https://github.com/cockroachdb/cockroach/pull/67901
[#67902]: https://github.com/cockroachdb/cockroach/pull/67902
[#67958]: https://github.com/cockroachdb/cockroach/pull/67958
[#67967]: https://github.com/cockroachdb/cockroach/pull/67967
[#67968]: https://github.com/cockroachdb/cockroach/pull/67968
[#67998]: https://github.com/cockroachdb/cockroach/pull/67998
[#68027]: https://github.com/cockroachdb/cockroach/pull/68027
[#68056]: https://github.com/cockroachdb/cockroach/pull/68056
[#68106]: https://github.com/cockroachdb/cockroach/pull/68106
[#68112]: https://github.com/cockroachdb/cockroach/pull/68112
[#68114]: https://github.com/cockroachdb/cockroach/pull/68114

## v21.1.6

Get future release notes emailed to you:

{% include marketo.html %}

### Downloads

<div id="os-tabs" class="filters clearfix">
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.6.linux-amd64.tgz"><button id="linux" class="filter-button" data-scope="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.6.darwin-10.9-amd64.tgz"><button id="mac" class="filter-button" data-scope="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.6.windows-6.2-amd64.zip"><button id="windows" class="filter-button" data-scope="windows" data-eventcategory="windows-binary-release-notes">Windows</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.6.src.tgz"><button id="source" class="filter-button" data-scope="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

<section class="filter-content" data-scope="windows">
{% include windows_warning.md %}
</section>

### Docker image

{% include copy-clipboard.html %}
~~~shell
$ docker pull cockroachdb/cockroach:v21.1.6
~~~

### General changes

- Switched the `release-21.1` branch to point to a fork of the Google Cloud SDK at version 0.45.1 with an [upstream bug fix](https://github.com/googleapis/google-cloud-go/pull/4226). [#66808][#66808]

### Enterprise edition changes

- Improved the internal buffering of [changefeeds](../v21.1/stream-data-out-of-cockroachdb-using-changefeeds.html) to be robust to bursts in traffic which exceed the throughput to the sink. [#67205][#67205]
- [Incremental backups](../v21.1/take-full-and-incremental-backups.html#incremental-backups) to a cloud storage location that already contains large existing backups now find their derived destination without listing as many remote files. [#67286][#67286]

### Operational changes

- Added logs for important events during the server draining/shutdown process: (1) log when the server closes an existing connection while draining, (2) log when the server rejects a new connection while draining, and (3) log when the server cancels in-flight queries after waiting for the [`server.shutdown.query_wait`](../v21.1/cluster-settings.html) duration to elapse while draining. [#66874][#66874] {% comment %}doc{% endcomment %}

### DB Console changes

- Fixed a bug preventing the [Custom Chart debug page](../v21.1/ui-custom-chart-debug-page.html) from loading on initial. [#66897][#66897]
- Added a drag-to-select timescale feature to the [Custom Chart debug page](../v21.1/ui-custom-chart-debug-page.html). [#66594][#66594] {% comment %}doc{% endcomment %}

### Bug fixes

- CockroachDB now allows a node with lease preferences to drain gracefully. [#66712][#66712]
- Fixed a panic that could occur in the [optimizer](../v21.1/cost-based-optimizer.html) when executing a prepared plan with placeholders. This could happen when one of the tables used by the query had computed columns or a partial index. [#66833][#66833]
- Fixed a bug that caused graceful drain to call `time.sleep` multiple times, which cut into time needed for range lease transfers. [#66851][#66851]
- Reduced CPU usage of idle `cockroach` processes. [#66894][#66894]
- Fixed an error that backup would produce in some [full backups with revision history](../v21.1/take-backups-with-revision-history-and-restore-from-a-point-in-time.html). Previously, some full backups would erroneously produce an error in the form of `batch timestamp <some_timestamp> must be after replica GC threshold <some_other_timestamp>`. [#66904][#66904]
- CockroachDB now avoids interacting with [decommissioned nodes](../v21.1/remove-nodes.html#how-it-works) during DistSQL planning and consistency checking. [#66950][#66950]
- [Changefeeds](../v21.1/stream-data-out-of-cockroachdb-using-changefeeds.html) no longer interact poorly with large, abandoned transactions. Previously, this combination could result in a cascade of work during transaction cleanup that could starve out foreground traffic. [#66813][#66813]
- [Changefeeds](../v21.1/stream-data-out-of-cockroachdb-using-changefeeds.html) now properly invalidate cached range descriptors and retry when encountering [decommissioned nodes](../v21.1/remove-nodes.html#how-it-works). [#67013][#67013]
- Fixed a bug where [metrics pages](../v21.1/ui-overview-dashboard.html) would lose their scroll position on chart data updates. [#67089][#67089]
- Fixed a bug which caused internal errors when running an [`IMPORT TABLE`](../v21.1/import.html) statement with a virtual computed column to import a CSV file. This bug has been present since virtual computed columns were introduced in v21.1.0. [#67043][#67043]
- Previously, the CLI would attribute some of the time spent running schema changes to network latency. This has now been fixed. Additionally, verbose timings in the CLI now also show time spent running schema changes in a separate bucket. [#65719][#65719]
- Fixed a statement buffer memory leak when using suspended portals. [#67372][#67372]
- [Changefeeds](../v21.1/stream-data-out-of-cockroachdb-using-changefeeds.html) on tables with array columns now support Avro. [#67433][#67433]
- Avro encoding now supports collated string types. [#67433][#67433]
- [`ENUM`](../v21.1/enum.html) columns can now be encoded in Avro [changefeeds](../v21.1/stream-data-out-of-cockroachdb-using-changefeeds.html) [#67433][#67433]
- Avro [changefeeds](../v21.1/stream-data-out-of-cockroachdb-using-changefeeds.html) now support `BIT` and `VARBIT` columns. [#67433][#67433]
- [`INTERVAL`](../v21.1/interval.html) columns are now supported in Avro [changefeeds](../v21.1/stream-data-out-of-cockroachdb-using-changefeeds.html). [#67433][#67433]

### Performance improvements

- CockroachDB now continues to generate histograms when table statistics collection reaches memory limits, instead of disabling histogram generation. [#67057][#67057] {% comment %}doc{% endcomment %}
- The [optimizer](../v21.1/cost-based-optimizer.html) now prefers performing a reverse scan over a forward scan + sort if the reverse scan eliminates the need for a sort and the plans are otherwise equivalent. Ihis was previously the case in most cases, but some edge cases with a small number of rows have been fixed. [#67388][#67388]
- When choosing between index scans that are estimated to have the same number of rows, the [optimizer](../v21.1/cost-based-optimizer.html) now prefers indexes for which it has higher certainty about the maximum number of rows over indexes for which there is more uncertainty in the estimated row count. This helps to avoid choosing suboptimal plans for small tables or if the statistics are stale. [#67388][#67388]

### Contributors

This release includes 47 merged PRs by 34 authors.
We would like to thank the following contributors from the CockroachDB community:

- joesankey (first-time contributor)

[#65719]: https://github.com/cockroachdb/cockroach/pull/65719
[#66594]: https://github.com/cockroachdb/cockroach/pull/66594
[#66712]: https://github.com/cockroachdb/cockroach/pull/66712
[#66808]: https://github.com/cockroachdb/cockroach/pull/66808
[#66813]: https://github.com/cockroachdb/cockroach/pull/66813
[#66833]: https://github.com/cockroachdb/cockroach/pull/66833
[#66851]: https://github.com/cockroachdb/cockroach/pull/66851
[#66874]: https://github.com/cockroachdb/cockroach/pull/66874
[#66894]: https://github.com/cockroachdb/cockroach/pull/66894
[#66897]: https://github.com/cockroachdb/cockroach/pull/66897
[#66904]: https://github.com/cockroachdb/cockroach/pull/66904
[#66950]: https://github.com/cockroachdb/cockroach/pull/66950
[#67013]: https://github.com/cockroachdb/cockroach/pull/67013
[#67043]: https://github.com/cockroachdb/cockroach/pull/67043
[#67057]: https://github.com/cockroachdb/cockroach/pull/67057
[#67089]: https://github.com/cockroachdb/cockroach/pull/67089
[#67205]: https://github.com/cockroachdb/cockroach/pull/67205
[#67286]: https://github.com/cockroachdb/cockroach/pull/67286
[#67356]: https://github.com/cockroachdb/cockroach/pull/67356
[#67372]: https://github.com/cockroachdb/cockroach/pull/67372
[#67388]: https://github.com/cockroachdb/cockroach/pull/67388
[#67433]: https://github.com/cockroachdb/cockroach/pull/67433

## v21.1.5

{{site.data.alerts.callout_danger}}
We recommend upgrading from [v21.1.4](v21.1.4.html) to this bugfix release as soon as possible.
{{site.data.alerts.end}}

Get future release notes emailed to you:

{% include marketo.html %}

### Downloads

<div id="os-tabs" class="filters clearfix">
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.5.linux-amd64.tgz"><button id="linux" class="filter-button" data-scope="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.5.darwin-10.9-amd64.tgz"><button id="mac" class="filter-button" data-scope="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.5.windows-6.2-amd64.zip"><button id="windows" class="filter-button" data-scope="windows" data-eventcategory="windows-binary-release-notes">Windows</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.5.src.tgz"><button id="source" class="filter-button" data-scope="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

<section class="filter-content" data-scope="windows">
{% include windows_warning.md %}
</section>

### Docker image

{% include copy-clipboard.html %}
~~~shell
$ docker pull cockroachdb/cockroach:v21.1.5
~~~

### Bug fixes

- Fixed a panic that could occur in the [optimizer](../v21.1/cost-based-optimizer.html) when executing a prepared plan with placeholders. This could happen when one of the tables used by the query had [computed columns](../v21.1/computed-columns.html) or a [partial index](../v21.1/partial-indexes.html). [#66883][#66883]

[#66883]: https://github.com/cockroachdb/cockroach/pull/66833

## v21.1.4

{{site.data.alerts.callout_danger}}
We recommend upgrading from this release to the [v21.1.5](v21.1.5.html) bugfix release as soon as possible.
{{site.data.alerts.end}}

Get future release notes emailed to you:

{% include marketo.html %}

### Downloads

<div id="os-tabs" class="filters clearfix">
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.4.linux-amd64.tgz"><button id="linux" class="filter-button" data-scope="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.4.darwin-10.9-amd64.tgz"><button id="mac" class="filter-button" data-scope="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.4.windows-6.2-amd64.zip"><button id="windows" class="filter-button" data-scope="windows" data-eventcategory="windows-binary-release-notes">Windows</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.4.src.tgz"><button id="source" class="filter-button" data-scope="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

<section class="filter-content" data-scope="windows">
{% include windows_warning.md %}
</section>

### Docker image

{% include copy-clipboard.html %}
~~~shell
$ docker pull cockroachdb/cockroach:v21.1.4
~~~

### Security updates

- Previously, all the [logging](../v21.1/logging-overview.html) output to files or network sinks was disabled temporarily while an operator was using the `/debug/logspy` HTTP API, resulting in lost entries and a breach of auditability guarantees. This behavior has been corrected. [#66328][#66328]
- CockroachDB now configures a maximum number of concurrent password verifications in the server process, across UI and SQL clients. This limit reduces the risk of DoS attacks or accidents due to misbehaving clients. By default, the maximum amount of concurrency is ~12% of the number of allocated CPU cores (as per `GOMAXPROCS`), with a minimum of 1 core. This default can be overridden using the environment variable `COCKROACH_MAX_BCRYPT_CONCURRENCY`. [#66367][#66367] {% comment %}doc{% endcomment %}

### SQL language changes

- Implemented the `ST_HasArc` [builtin function](../v21.1/functions-and-operators.html#spatial-functions). This adds better out-of-the-box support for [GeoServer](../v21.1/geoserver.html). [#66531][#66531] {% comment %}doc{% endcomment %}
- Added a new internal [cluster setting](../v21.1/cluster-settings.html), `jobs.cancel_update_limit`, for controlling how many [jobs](../v21.1/show-jobs.html) are cleaned up concurrently after query cancellation. [#66488][#66488] {% comment %}doc{% endcomment %}

### Command-line changes

- The [SQL shell](../v21.1/cockroach-sql.html) now formats times with time zones so that the minutes and seconds offsets are only shown if they are non-zero. Also, infinite floating point values are now formatted as `Infinity` rather than `Inf`. [#66130][#66130] {% comment %}doc{% endcomment %}
- When [log entries](../v21.1/logging-overview.html) are written to disk, the first few header lines written at the start of every new file now report the configured [logging format](../v21.1/log-formats.html). [#66328][#66328] {% comment %}doc{% endcomment %}

### API endpoint changes

- The `/debug/logspy` HTTP API has changed. The endpoint now returns JSON data by default. If the previous format is desired, the user can pass the query argument `&flatten=1` to the `logspy` URL to obtain the previous flat text format (`crdb-v1`) instead. [#66328][#66328] This change is motivated as follows: {% comment %}doc{% endcomment %}
    - The previous format, `crdb-v1`, cannot be parsed reliably.
    - Using JSON entries guarantees that the text of each entry all fits on a single line of output (newline characters inside the messages are escaped). This makes filtering easier and more reliable.
    - Using JSON enables the user to apply `jq` on the output, for example via `curl -s .../debug/logspy | jq ...`.
- The `/debug/logspy` API no longer enables maximum logging verbosity automatically. To change the verbosity, use the new `/debug/vmodule` endpoint or pass the `&vmodule=` query parameter to the `/debug/logspy` endpoint. [#66328][#66328] For example, suppose you wish to run a 20s logspy session: {% comment %}doc{% endcomment %}
    - Before: `curl 'https://.../debug/logspy?duration=20s&...'`.
    - Now: `curl 'https://.../debug/logspy?duration=20s&vmodule=...'` OR `curl 'https://.../debug/vmodule?duration=22s&vmodule=...'   curl 'https://.../debug/logspy?duration=20s'`.
    - As for the regular `vmodule` command-line flag, the maximum verbosity across all the source code can be selected with the pattern `*=4`.
    - Note: at most one in-flight HTTP API request is allowed to modify the `vmodule` parameter. This maintains the invariant that the configuration restored at the end of each request is the same as when the request started.
- The new `/debug/vmodule` API makes it possible for an operator to configure the logging verbosity in a similar way as the SQL [builtin function](../v21.1/functions-and-operators.html) `crdb_internal.set_vmodule()`, or to query the current configuration as in `crdb_internal.get_vmodule()`. Additionally, any configuration change performed via this API can be automatically reverted after a configurable delay. [#66328][#66328] The API forms are: {% comment %}doc{% endcomment %}
    - `/debug/vmodule`: Retrieve the current configuration
    - `/debug/vmodule?set=[vmodule config]&duration=[duration]`: Change the configuration to `[vmodule config]` . The previous configuration at the time the `/debug/vmodule` request started is restored after `[duration]`. This duration, if not specified, defaults to twice the default duration of a `logspy` request (currently, the `logspy`   default duration is 5s, so the `vmodule` default duration is 10s). If the duration is zero or negative, the previous configuration is never restored.

### DB Console changes

- Fixed an issue with displaying more than 100 hours of remaining time on the [Jobs page](../v21.1/ui-jobs-page.html). [#66596][#66596]

### Bug fixes

- Minute timezone offsets are only displayed in the wire protocol if they are non-zero for `TimestampTZ` and `TimeTZ` values. Previously, they would always display. [#66130][#66130]
- Fixed a bug where binary `TimeTZ` values were not being decoded correctly when being sent as a parameter in the wire protocol. [#66130][#66130]
- CockroachDB's [SQL shell](../v21.1/cockroach-sql.html) now properly displays results of common array types, for example: arrays of floats, or arrays of strings. [#66130][#66130]
- Fixed a bug where the `--log='file-defaults: {format: crdb-v1}'` flag was not being handled properly. This bug existed since v21.1.0. [#66328][#66328]
- Fixed a bug where log entries could be lost while the `/debug/logspy` HTTP API was being used. This bug had existed since CockroachDB v1.1. [#66328][#66328]
- The binary encoding of decimals will no longer have negative `dscale` values. This was preventing [Npgsql](https://www.npgsql.org) from being able to read some binary decimals from CockroachDB. [#66532][#66532]
- A bug has been fixed which prevented the [optimizer](../v21.1/cost-based-optimizer.html) from producing plans with [partial indexes](../v21.1/partial-indexes.html) when executing some prepared statements that contained placeholders, stable functions, or casts. This bug was present since partial indexes were added in v20.2.0. [#66634][#66634]
- Fixed a bug which could have prevented [backups](../v21.1/backup.html) from being successfully [restored](../v21.1/restore.html). [#66616][#66616]
- Fixed a bug where CockroachDB could crash when executing [`EXPLAIN (VEC)`](../v21.1/explain.html#vec-option) on some mutations. The bug is present only in the v21.1.1-v21.1.3 releases. [#66573][#66573]
- Fixed a bug where CockroachDB could encounter an internal error when computing [window functions](../v21.1/window-functions.html) with `ROWS` mode of window framing if the offsets were very large for the `OFFSET FOLLOWING` boundary type. [#66446][#66446]
- Fixed a bug where using [`ADD COLUMN UNIQUE`](../v21.1/add-column.html) on [`REGIONAL BY ROW` tables](../v21.1/set-locality.html#regional-by-row) did not correctly add the [zone configs](../v21.1/configure-replication-zones.html) for the newly created column index. [#66696][#66696]
- Fixed a bug where reading from Google Cloud Storage was not using the resuming reader, as a result of which some retriable errors were not being treated as such, and the read would fail. [#66190][#66190]
- Fixed a deadlock during [backups](../v21.1/backup.html) and [imports](../v21.1/import.html). [#66773][#66773]
- Fixed incorrect accounting for statement/transaction sampled [execution statistics](../v21.1/explain-analyze.html). [#66790][#66790]
- Fixed a bug causing [transactions](../v21.1/transactions.html) to be spuriously aborted in rare circumstances. [#66567][#66567]

### DB Console

- Fixed a CSS width calculation which was causing the multibar to not be visible in the [DB Console](../v21.1/ui-overview.html). [#66739][#66739]

### Contributors

This release includes 28 merged PRs by 22 authors.

[#66130]: https://github.com/cockroachdb/cockroach/pull/66130
[#66190]: https://github.com/cockroachdb/cockroach/pull/66190
[#66328]: https://github.com/cockroachdb/cockroach/pull/66328
[#66367]: https://github.com/cockroachdb/cockroach/pull/66367
[#66446]: https://github.com/cockroachdb/cockroach/pull/66446
[#66473]: https://github.com/cockroachdb/cockroach/pull/66473
[#66488]: https://github.com/cockroachdb/cockroach/pull/66488
[#66531]: https://github.com/cockroachdb/cockroach/pull/66531
[#66532]: https://github.com/cockroachdb/cockroach/pull/66532
[#66567]: https://github.com/cockroachdb/cockroach/pull/66567
[#66573]: https://github.com/cockroachdb/cockroach/pull/66573
[#66596]: https://github.com/cockroachdb/cockroach/pull/66596
[#66616]: https://github.com/cockroachdb/cockroach/pull/66616
[#66634]: https://github.com/cockroachdb/cockroach/pull/66634
[#66696]: https://github.com/cockroachdb/cockroach/pull/66696
[#66739]: https://github.com/cockroachdb/cockroach/pull/66739
[#66773]: https://github.com/cockroachdb/cockroach/pull/66773
[#66790]: https://github.com/cockroachdb/cockroach/pull/66790

## v21.1.3

This page lists additions and changes in v21.1.3 since v21.1.2.

- For a comprehensive summary of features in v21.1, see the [v21.1 GA release notes](v21.1.0.html).
- To upgrade to v21.1, see [Upgrade to CockroachDB v21.1](../v21.1/upgrade-cockroach-version.html).

Get future release notes emailed to you:

{% include marketo.html %}

### Downloads

<div id="os-tabs" class="filters clearfix">
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.3.linux-amd64.tgz"><button id="linux" class="filter-button" data-scope="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.3.darwin-10.9-amd64.tgz"><button id="mac" class="filter-button" data-scope="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.3.windows-6.2-amd64.zip"><button id="windows" class="filter-button" data-scope="windows" data-eventcategory="windows-binary-release-notes">Windows</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.3.src.tgz"><button id="source" class="filter-button" data-scope="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

<section class="filter-content" data-scope="windows">
{% include windows_warning.md %}
</section>

### Docker image

{% include copy-clipboard.html %}
~~~shell
$ docker pull cockroachdb/cockroach:v21.1.3
~~~

### Security updates

- Syntax errors in the host-based authentication (HBA) configuration in cluster setting `server.host_based_authentication.configuration` are now logged on the [OPS channel](../v21.1/logging.html). [#66128][#66128] {% comment %}doc{% endcomment %}
- The `User` and `ApplicationName` fields of structured events pertaining to SQL queries are now marked as non-sensitive when they contain certain values (`root`/`node` for `User` and values starting with `$` for application names). [#66443][#66443] {% comment %}doc{% endcomment %}

### Enterprise edition changes

- Changefeeds with custom Kafka client configurations (using the `kafka_sink_config` object) that could lead to long delays in flushing messages will now produce an error. [#66265][#66265] {% comment %}doc{% endcomment %}
- The `kafka_sink_config` object now supports a `version` configuration item to specify Kafka server versions. This is likely only necessary for old (Kafka 0.11/Confluent 3.3 or earlier) Kafka servers. Additionally, settings not specified in `kafka_sink_config` now retain their default values. [#66314][#66314] {% comment %}doc{% endcomment %}

### SQL language changes

- [`TRUNCATE`](../v21.1/truncate.html) is now less disruptive on tables with a large amount of concurrent traffic. [#65940][#65940] {% comment %}doc{% endcomment %}
- Creating `STORED` or `VIRTUAL` [computed columns](../v21.1/computed-columns.html) with expressions that reference [foreign key](../v21.1/foreign-key.html) columns is now allowed. [#66168][#66168] {% comment %}doc{% endcomment %}
- The new function [`crdb_internal.get_vmodule`](../v21.1/functions-and-operators.html#system-info-functions) returns the current `vmodule` configuration on the node processing the request. [#63545][#63545] {% comment %}doc{% endcomment %}
- The description string for the `random()` function now clarifies that there are at most 53 bits of randomness available; that is, the function is unsuitable to generate 64-bit random integer values. This behavior is similar to that of PostgreSQL. [#66128][#66128] {% comment %}doc{% endcomment %}
- [`EXPLAIN ANALYZE`](../v21.1/explain-analyze.html) now displays information about the regions on which a statement was executed. [#66368][#66368] {% comment %}doc{% endcomment %}

### Operational changes

- Added a configurable limit to the number of intents collected by a `scan` before aborting, to prevent out-of-memory errors. The setting `storage.mvcc.max_intents_per_error` replaces `storage.sst_export.max_intents_per_error` and covers both `scan` and `export` commands. [#65923][#65923] {% comment %}doc{% endcomment %}
- [`BACKUP`](../v21.1/backup.html) now puts backup data files in a `data` sub-directory of the `BACKUP` path instead of directly in the backup path. [#66161][#66161] {% comment %}doc{% endcomment %}

### Command-line changes

- The informational messages printed out when [`cockroach demo`](../v21.1/cockroach-demo.html) starts have been updated to clarify that certain information is only needed when accessing the demo cluster from another tool. [#66129][#66129] {% comment %}doc{% endcomment %}
- [`cockroach demo`](../v21.1/cockroach-demo.html) and [`cockroach sql`](../v21.1/cockroach-sql.html) are now able to run client-side commands via the `-e` command-line flag. This makes it possible to use commands like `\dt` or `\hf` from a shell script. [#66326][#66326] {% comment %}doc{% endcomment %}

### DB Console changes

- Users can now reset SQL stats from the [DB Console](../v21.1/ui-overview.html). [#65916][#65916] {% comment %}doc{% endcomment %}
- Removed shading on line graphs, improving legibility when viewing more than a few series on the same plot. [#66032][#66032] {% comment %}doc{% endcomment %}
- Drag-to-zoom on metrics graphs now supports time ranges under 10 minutes. [#66032][#66032] {% comment %}doc{% endcomment %}
- In some cases, the Execution Stats page would show a very high Overhead latency for a statement. This could happen due to multiple statements being parsed together or due to statement execution being retried. To avoid this, we no longer consider the time between when parsing ends and execution begins when determining service latency. [#66108][#66108] {% comment %}doc{% endcomment %}
- Improved the style of the password input field for Safari. [#66134][#66134]
- The metrics chart under Overview was renamed from `SQL Queries` to `SQL Statements` to match the naming used under SQL Metrics. [#66364][#66364] {% comment %}doc{% endcomment %}

### Bug fixes

- Fixed a bug which prevented adding columns to tables which contain data and use `NOT NULL` virtual columns [#65973][#65973]
- Fixed a bug in the DB Console where graphs for clusters with decommissioned nodes could show an empty series and data could be incorrectly attributed to the wrong nodes. [#66032][#66032]
- Fixed a bug where queries on `REGIONAL BY ROW` tables could fail in the brief window in which a DROP REGION operation is in progress. [#65984][#65984]
- Fixed a bug where a schema's privilege descriptor could be corrupted upon executing `ALTER DATABASE ... CONVERT TO SCHEMA`, where privileges invalid on a schema were copied from the database, rendering the schema unusable. [#65993][#65993]
- Fixed the error classification for duplicate index names where the later index was a `UNIQUE` index. [#64000][#64000]
- Fixed the error classification for `ALTER TABLE ... ADD CONSTRAINT ... UNIQUE` with the same name as an existing index. [#64000][#64000]
- Fixed a bug that made it less likely for range merges to succeed on clusters using multiple stores per node is now fixed. [#65889][#65889]
- Improved `TRUNCATE` operations to prevent contention issues. [#65940][#65940]
- Improved garbage collection of stale replicas by proactively checking certain replicas that have lost contact with other voting replicas. [#65186][#65186]
- Fixed a bug in `SHOW RANGES` which misattributed localities to nodes when using multiple stores. [#66037][#66037]
- Queries run through the `EXECUTE` statement can now generate statement diagnostic bundles as expected. [#66098][#66098]
- Previously, an `INSERT` causing a foreign key violation could result in an internal error in rare cases. The bug only affected the error response; any affected `INSERT`s (which would have been foreign-key violations) did not succeed. This bug, present since v21.1.0, has been fixed. [#66300][#66300]
- `BACKUP` and other operations can now reuse a previously created S3 client session when operating on the same bucket, which can avoid `NoCredentialProviders` errors on EC2 when interating with large incremental backups. [#66259][#66259]
- The command exit status of `cockroach demo` and `cockroach sql` is now properly set to non-zero (error) after an error is encountered in a client-side command. Additionally, `cockroach sql` and `cockroach demo` now properly stop upon encountering an invalid configuration with `--set`, instead of starting to execute SQL statements after the invalid configuration. [#66326][#66326]
- Improved the availability of the jobs table for reads in large, global clusters by running background tasks at low priority. [#66344][#66344]
- Backups no longer risk the possibility of blocking conflicting writes while being rate limited by the `kv.bulk_io_write.concurrent_export_requests` concurrency limit. [#66408][#66408]
- The `soundex` and `st_difference` [builtin functions](../v21.1/functions-and-operators.html#built-in-functions) for fuzzy string matching now correctly handle `NULL` values. [#66302][#66302]

### Performance improvements

- Fixed an issue in the optimizer that prevented spatial predicates of the form `(column && value) = true` from being index-accelerated. These queries can now use a [spatial index](../v21.1/spatial-indexes.html) if one is available. [#65986][#65986]
- The optimizer is now more efficient when planning queries on tables that have many columns and indexes. [#66304][#66304]
- The `COCKROACHDB_REGISTRY` file is no longer rewritten whenever a new unencrypted file is created. [#66423][#66423] {% comment %}doc{% endcomment %}
- After improvements, queries use up to 1MB less system memory per scan, [lookup join, index join, zigzag join, or inverted join](../v21.1/joins.html) in their query plans. This will result in improved memory performance for workloads with concurrent OLAP-style queries. [#66145][#66145]
- Made improvements to prevent intra-query leaks during disk spilling that could cause the database to run out of memory, especially on tables with wide rows. [#66145][#66145]

### Contributors

This release includes 64 merged PRs by 35 authors.


[#63545]: https://github.com/cockroachdb/cockroach/pull/63545
[#64000]: https://github.com/cockroachdb/cockroach/pull/64000
[#65186]: https://github.com/cockroachdb/cockroach/pull/65186
[#65889]: https://github.com/cockroachdb/cockroach/pull/65889
[#65916]: https://github.com/cockroachdb/cockroach/pull/65916
[#65923]: https://github.com/cockroachdb/cockroach/pull/65923
[#65940]: https://github.com/cockroachdb/cockroach/pull/65940
[#65973]: https://github.com/cockroachdb/cockroach/pull/65973
[#65984]: https://github.com/cockroachdb/cockroach/pull/65984
[#65986]: https://github.com/cockroachdb/cockroach/pull/65986
[#65993]: https://github.com/cockroachdb/cockroach/pull/65993
[#66022]: https://github.com/cockroachdb/cockroach/pull/66022
[#66032]: https://github.com/cockroachdb/cockroach/pull/66032
[#66037]: https://github.com/cockroachdb/cockroach/pull/66037
[#66098]: https://github.com/cockroachdb/cockroach/pull/66098
[#66108]: https://github.com/cockroachdb/cockroach/pull/66108
[#66128]: https://github.com/cockroachdb/cockroach/pull/66128
[#66129]: https://github.com/cockroachdb/cockroach/pull/66129
[#66134]: https://github.com/cockroachdb/cockroach/pull/66134
[#66145]: https://github.com/cockroachdb/cockroach/pull/66145
[#66161]: https://github.com/cockroachdb/cockroach/pull/66161
[#66168]: https://github.com/cockroachdb/cockroach/pull/66168
[#66259]: https://github.com/cockroachdb/cockroach/pull/66259
[#66265]: https://github.com/cockroachdb/cockroach/pull/66265
[#66300]: https://github.com/cockroachdb/cockroach/pull/66300
[#66302]: https://github.com/cockroachdb/cockroach/pull/66302
[#66304]: https://github.com/cockroachdb/cockroach/pull/66304
[#66314]: https://github.com/cockroachdb/cockroach/pull/66314
[#66326]: https://github.com/cockroachdb/cockroach/pull/66326
[#66344]: https://github.com/cockroachdb/cockroach/pull/66344
[#66364]: https://github.com/cockroachdb/cockroach/pull/66364
[#66368]: https://github.com/cockroachdb/cockroach/pull/66368
[#66408]: https://github.com/cockroachdb/cockroach/pull/66408
[#66423]: https://github.com/cockroachdb/cockroach/pull/66423
[#66443]: https://github.com/cockroachdb/cockroach/pull/66443
[#66453]: https://github.com/cockroachdb/cockroach/pull/66453
[#66508]: https://github.com/cockroachdb/cockroach/pull/66508

## v21.1.2

- For a comprehensive summary of features in v21.1, see the [v21.1 GA release notes](v21.1.0.html).
- To upgrade to v21.1, see [Upgrade to CockroachDB v21.1](../v21.1/upgrade-cockroach-version.html).

Get future release notes emailed to you:

{% include marketo.html %}

### Downloads

<div id="os-tabs" class="filters clearfix">
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.2.linux-amd64.tgz"><button id="linux" class="filter-button" data-scope="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.2.darwin-10.9-amd64.tgz"><button id="mac" class="filter-button" data-scope="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.2.windows-6.2-amd64.zip"><button id="windows" class="filter-button" data-scope="windows" data-eventcategory="windows-binary-release-notes">Windows</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.2.src.tgz"><button id="source" class="filter-button" data-scope="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

<section class="filter-content" data-scope="windows">
{% include windows_warning.md %}
</section>

### Docker image

{% include copy-clipboard.html %}
~~~shell
$ docker pull cockroachdb/cockroach:v21.1.2
~~~

### General changes

- Added [multi-region workloads](../v21.1/multi-region-overview.html) for `cockroach demo movr --geo-partitioned-replicas`. Setting `--multi-region` enables for multi-region workloads, and setting `--survive` allows for surviving `AZ` or `REGION` failures. Setting `--infer-crdb-region-column` also infers the `crdb_region` for `REGIONAL BY ROW` tables. [#65642][#65642] {% comment %}doc{% endcomment %}
- [Changefeeds](../v21.1/create-changefeed.html) now better handle slow or unavailable sinks by treating "memory exceeded" errors as retryable. [#65387][#65387] {% comment %}doc{% endcomment %}

### SQL language changes

- Added the `crdb_internal.lost_descriptors_with_data` [function](../v21.1/functions-and-operators.html) to show descriptors that have no entries but data left behind. [#65462][#65462] {% comment %}doc{% endcomment %}
- Added the `crdb_internal.force_delete_table_data` [function](../v21.1/functions-and-operators.html) which allows table data to be cleaned up only using a descriptor ID for cases of table descriptor corruption. [#65462][#65462] {% comment %}doc{% endcomment %}
- The statement type ("tag") is now also included alongside the full text of the SQL query in the various structured log entries produced when query execution is being [logged](../v21.1/logging-overview.html). [#65554][#65554] {% comment %}doc{% endcomment %}
- CockroachDB now returns a SQL Notice if a [`CREATE TABLE IF NOT EXISTS`](../v21.1/create-table.html) command is used to create a `TABLE` and the `TABLE` already exists. [#65636][#65636] {% comment %}doc{% endcomment %}
- The `SHOW FULL TABLE SCANS` statement was added to CockroachDB. [#65671][#65671] {% comment %}doc{% endcomment %}
- CockroachDB now returns a SQL Notice if a [`CREATE TYPE IF NOT EXISTS`](../v21.1/create-type.html) command is used to create a type and the type already exists. [#65635][#65635] {% comment %}doc{% endcomment %}
- Added a `chunk_size` option to [`EXPORT INTO CSV`](../v21.1/export.html) to control the target CSV file size. [#65388][#65388] {% comment %}doc{% endcomment %}
- SQL stats can now be cleared using the `crdb_internal.reset_sql_stats()` function. [#65674][#65674] {% comment %}doc{% endcomment %}
- CockroachDB now supports [`ALTER DATABASE ... ADD REGION IF NOT EXISTS ...`](../v21.1/add-region.html) which does not cause an error when adding a region that is already in the database. [#65752][#65752] {% comment %}doc{% endcomment %}
- CockroachDB now outputs a clearer error message when running [`ALTER DATABASE ... ADD REGION ...`](../v21.1/add-region.html) if the region is an undefined region. Previously, the error message for not having a region defined on a database resulted in an error about enums. [#65752][#65752] {% comment %}doc{% endcomment %}
- Added the [`ALTER DATABASE ... DROP REGION IF EXISTS ...`](../v21.1/drop-region.html) statement syntax, which does not error if dropping a region that is not defined on the database. [#65752][#65752] {% comment %}doc{% endcomment %}
- Fixed a bug where transitioning from locality `REGIONAL BY ROW` to `GLOBAL` or `REGIONAL BY TABLE` could mistakenly remove a zone configuration on an index which has no multi-region fields set. [#65833][#65833] {% comment %}doc{% endcomment %}
- CockroachDB now only blocks a [zone configuration DISCARD](../v21.1/configure-zone.html) on a multi-region table, index, or partition if the multi-region abstractions created the zone configuration. [#65834][#65834] {% comment %}doc{% endcomment %}

### Operational changes

- [Range metrics](../v21.1/ui-replication-dashboard.html) are now gathered from the leaseholder (if live) rather than the first available range replica. This avoids scenarios where a stale replica may yield incorrect metrics, in particular over/underreplication markers. [#64590][#64590] {% comment %}doc{% endcomment %}

### DB Console changes

- Fixed [Jobs page](../v21.1/ui-jobs-page.html) crash while using pagination and improved its performance. [#65723][#65723]
- Fixed a typo on the Network tooltip on the [Statements page](../v21.1/ui-statements-page.html). [#65605][#65605]
- Fixed a missing node ID in the rejoin [event message](../v21.1/ui-runtime-dashboard.html#events-panel) [#65806][#65806]
- Sorts on tables now pick up the correct value from the URL. [#65605][#65605]

### Bug fixes

- Fixed a bug where a certain percentage of cases in which a node could have served a [follower read](../v21.1/follower-reads.html) were not handled correctly, resulting in the node routing the request to another nearby node for no reason. [#65471][#65471]
- The [`has_database_privilege`](../v21.1/functions-and-operators.html) function now correctly will check privileges on databases that are not the current database being used by the session. [#65534][#65534]
- Fixed a bug where CockroachDB would previously crash when attempting to create a table using [`CREATE TABLE ... AS`](../v21.1/create-table-as.html) syntax where the `AS` clause selects from `crdb_internal.node_statement_statistics`, `crdb_internal.node_transaction_statistics`, or `crdb_internal.node_txn_stats` virtual tables. [#65542][#65542]
- Fixed a bug which allowed [index definitions](../v21.1/indexes.html) with redundant columns, which led to unnecessary storage usage. This bug can notably manifest itself with [`ALTER TABLE`](../v21.1/alter-table.html) statements which alter the primary index on a partitioned table. This bug has been present for a long time in theory, but in practice would only appear in CockroachDB since version 21.1.0. [#65482][#65482]
- Fixed a bug where binary [`TIMETZ`](../v21.1/time.html) values were not being decoded correctly when being sent as a parameter in the wire protocol. [#65341][#65341]
- Fixed a race condition during transaction cleanup that could leave old transaction records behind until [MVCC garbage collection](../v21.1/architecture/storage-layer.html#mvcc). [#65383][#65383]
- Improved [transaction cleanup](../v21.1/architecture/transaction-layer.html) for disconnected clients, to reduce intent buildup. [#65383][#65383]
- Added the ability to change the `COMMENT` on a column after using [`ALTER TYPE`](../v21.1/alter-type.html) on that column. [#65698][#65698]
- [Scheduled backup](../v21.1/create-schedule-for-backup.html) with [interleaved tables](../v21.1/interleave-in-parent.html) can now be created with the `include_deprecated_interleaves` option. [#65731][#65731]
- Fixed a bug where `ST_Node` on a [`LINESTRING`](../v21.1/linestring.html) with the same repeated points results in an error. [#65700][#65700]
- Calling [`get_bit` or `set_bit`](../v21.1/functions-and-operators.html) on a byte array argument now goes to the correct index of the underlying bit string, in order to match the behavior of Postgres. [#65786][#65786]
- Fixed a bug where [`ALTER DATABASE ... CONVERT TO SCHEMA`](../v21.1/convert-to-schema.html) could potentially leave the schema with invalid privileges thus causing the privilege descriptor to be invalid. [#65810][#65810]
- CockroachDB now renders the `CACHE` clause for [sequences](../v21.1/create-sequence.html) which use a cache. [#65805][#65805]
- Fixed a bug that could cause a node to crash in rare cases if a [`BACKUP`](../v21.1/backup.html) writing to Google Cloud Storage failed. [#65802][#65802]
- Fixed a bug introduced in 21.1 where [cluster restores](../v21.1/restore.html) would report inaccurate progress, showing 100% progress erroneously. [#65803][#65803]
- Fixed a crash when performing a cluster [`BACKUP`](../v21.1/backup.html) with revision history of a cluster upgraded from 20.1 to 20.2 to 21.1 which contains tables that were truncated by 20.1. [#65860][#65860]
- Fixed a bug that caused incorrect results for queries where [`CHAR` and `VARCHAR`](../v21.1/string.html#related-types) columns are filtered by constant string values. The bug was present since version v21.1.0. [#66101][#66101]

### Performance improvements

- The [optimizer](../v21.1/cost-based-optimizer.html) can now avoid full table scans for queries with a [`LIMIT`](../v21.1/limit-offset.html) and [`ORDER BY`](../v21.1/order-by.html) clause in some additional cases where the `ORDER BY` columns are not a prefix of an index. [#65392][#65392]
- The [optimizer](../v21.1/cost-based-optimizer.html) now generates query plans that scan indexes on virtual collated string columns, regardless of the casing or formatting of the collated locale in the query. [#65531][#65531]
- CockroachDB now reduces the number of round-trips required to call `pg_table_is_visible` in the context of [`pg_catalog` queries](../v21.1/pg-catalog.html). [#65807][#65807]

### Contributors

This release includes 58 merged PRs by 34 authors.
We would like to thank the following contributors from the CockroachDB community:

- Max Neverov
- Rupesh Harode

[#64590]: https://github.com/cockroachdb/cockroach/pull/64590
[#65341]: https://github.com/cockroachdb/cockroach/pull/65341
[#65383]: https://github.com/cockroachdb/cockroach/pull/65383
[#65387]: https://github.com/cockroachdb/cockroach/pull/65387
[#65388]: https://github.com/cockroachdb/cockroach/pull/65388
[#65392]: https://github.com/cockroachdb/cockroach/pull/65392
[#65462]: https://github.com/cockroachdb/cockroach/pull/65462
[#65471]: https://github.com/cockroachdb/cockroach/pull/65471
[#65482]: https://github.com/cockroachdb/cockroach/pull/65482
[#65531]: https://github.com/cockroachdb/cockroach/pull/65531
[#65534]: https://github.com/cockroachdb/cockroach/pull/65534
[#65542]: https://github.com/cockroachdb/cockroach/pull/65542
[#65554]: https://github.com/cockroachdb/cockroach/pull/65554
[#65605]: https://github.com/cockroachdb/cockroach/pull/65605
[#65635]: https://github.com/cockroachdb/cockroach/pull/65635
[#65636]: https://github.com/cockroachdb/cockroach/pull/65636
[#65642]: https://github.com/cockroachdb/cockroach/pull/65642
[#65671]: https://github.com/cockroachdb/cockroach/pull/65671
[#65674]: https://github.com/cockroachdb/cockroach/pull/65674
[#65698]: https://github.com/cockroachdb/cockroach/pull/65698
[#65700]: https://github.com/cockroachdb/cockroach/pull/65700
[#65723]: https://github.com/cockroachdb/cockroach/pull/65723
[#65731]: https://github.com/cockroachdb/cockroach/pull/65731
[#65752]: https://github.com/cockroachdb/cockroach/pull/65752
[#65786]: https://github.com/cockroachdb/cockroach/pull/65786
[#65802]: https://github.com/cockroachdb/cockroach/pull/65802
[#65803]: https://github.com/cockroachdb/cockroach/pull/65803
[#65805]: https://github.com/cockroachdb/cockroach/pull/65805
[#65806]: https://github.com/cockroachdb/cockroach/pull/65806
[#65807]: https://github.com/cockroachdb/cockroach/pull/65807
[#65810]: https://github.com/cockroachdb/cockroach/pull/65810
[#65833]: https://github.com/cockroachdb/cockroach/pull/65833
[#65834]: https://github.com/cockroachdb/cockroach/pull/65834
[#65860]: https://github.com/cockroachdb/cockroach/pull/65860
[#66101]: https://github.com/cockroachdb/cockroach/pull/66101

## v21.1.1

- For a comprehensive summary of features in v21.1, see the [v21.1 GA release notes](v21.1.0.html).
- To upgrade to v21.1, see [Upgrade to CockroachDB v21.1](../v21.1/upgrade-cockroach-version.html).

Get future release notes emailed to you:

{% include marketo.html %}


### Downloads

<div id="os-tabs" class="filters clearfix">
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.1.linux-amd64.tgz"><button id="linux" class="filter-button" data-scope="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.1.darwin-10.9-amd64.tgz"><button id="mac" class="filter-button" data-scope="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.1.windows-6.2-amd64.zip"><button id="windows" class="filter-button" data-scope="windows" data-eventcategory="windows-binary-release-notes">Windows</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.1.src.tgz"><button id="source" class="filter-button" data-scope="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

<section class="filter-content" data-scope="windows">
{% include windows_warning.md %}
</section>

### Docker image

{% include copy-clipboard.html %}
~~~shell
$ docker pull cockroachdb/cockroach:v21.1.1
~~~


### General changes

- Disabled read-triggered compactions to avoid instances where the [storage engine](../v21.1/architecture/storage-layer.html) would compact excessively. [#65345][#65345]

### SQL language changes

- Fixed [Julian date](https://en.wikipedia.org/wiki/Julian_day) parsing logic for wrong formats. [#63540][#63540]
- The error payload returned to the client when a [`DATE`](../v21.1/date.html)/[`TIME`](../v21.1/time.html) conversion fails now contains more details about the difference between the values provided and the values that are expected. [#63540][#63540] {% comment %}doc{% endcomment %}
- Introduced `ALTER TABLE ... ALTER COLUMN SET [VISIBLE|NOT VISIBLE]`, which marks columns as visible/not visible. [#63881][#63881] {% comment %}doc{% endcomment %}
- When using [`ALTER TABLE ... LOCALITY REGIONAL BY ROW`](../v21.1/set-locality.html), we would previously verify uniqueness of the new table, which was an unnecessary operation. This verification has been removed, improving the performance of updating localities to or from `REGIONAL BY ROW`. [#63880][#63880] {% comment %}doc{% endcomment %}
- Improved cancellation behavior for [DistSQL](../v21.1/architecture/sql-layer.html) flows. [#65047][#65047] {% comment %}doc{% endcomment %}
- [`ST_EstimatedExtent`](../v21.1/functions-and-operators.html#spatial-functions) now always returns `NULL`. This allows [GeoServer](http://geoserver.org/) to make progress in certain cases, and is a valid default return value for the function. [#65098][#65098] {% comment %}doc{% endcomment %}
- Implemented `ST_Envelope` for [`Box2D`](../v21.1/spatial-glossary.html#data-types). [#65098][#65098] {% comment %}doc{% endcomment %}
- Implemented a subset of variants for `ST_AsTWKB`, which encodes a geometry into a [`TWKB`](https://github.com/TWKB/Specification/blob/master/twkb.md) format. This allows the use of [GeoServer](https://docs.geoserver.org/latest/en/user/) with CRDB if the user selects "PreserveTopology" for their "Method used to simplify geometries" option on the "Store" page. [#65098][#65098] {% comment %}doc{% endcomment %}
- Implemented `ST_Simplify` with [`preserveCollapsed`](https://postgis.net/docs/ST_Simplify.html) support. This unblocks the use of GeoServer with the default settings. [#65098][#65098] {% comment %}doc{% endcomment %}
- [Lookup joins](../v21.1/joins.html) on indexes with [computed columns](../v21.1/computed-columns.html) which are also either constrained by [`CHECK`](../v21.1/check.html) constraints or use an [`ENUM`](../v21.1/enum.html) data type may now choose a more optimal plan. [#65361][#65361] {% comment %}doc{% endcomment %}
- Floating point infinity values are now formatted as `Infinity` (or `-Infinity` if negative). This is for compatibility with PostgresSQL. [#65334][#65334] {% comment %}doc{% endcomment %}
- [`INSERT INTO ... ON CONFLICT ... DO UPDATE SET`](../v21.1/insert.html) statements without predicates now acquire locks using the `FOR UPDATE` locking mode during their initial row scan, which improves performance for contended workloads. This behavior is configurable using the `enable_implicit_select_for_update` [session variable](../v21.1/set-vars.html) and the `sql.defaults.implicit_select_for_update.enabled` [cluster setting](../v21.1/cluster-settings.html). [#65363][#65363] {% comment %}doc{% endcomment %}
- [`ST_GeomFromGeoJSON(string)`](../v21.1/functions-and-operators.html#spatial-functions) is now marked as the preferred overload, meaning it will resolve correctly in more contexts. [#65442][#65442] {% comment %}doc{% endcomment %}

### Operational changes

- [Replica garbage collection](../v21.1/architecture/storage-layer.html#garbage-collection) now checks replicas against the range descriptor every 12 hours (down from 10 days) to see if they should be removed. Replicas that fail to notice they have been removed from a range will therefore linger for at most 12 hours rather than 10 days. [#64589][#64589]

### Command-line changes

- The `--help` text for [`--log`](../v21.1/configure-logs.html) now references the fact that the flag accepts YAML syntax and also points to the `cockroach debug check-log-config` command. [#64948][#64948]
- The new parameter `--log-config-file` simplifies the process of loading the logging configuration from a YAML file. Instead of passing the content of the file via the `--log` flag (e.g., `--log=$(cat file.yaml)`), it is now possible to pass the path to the file using `--log-config-file=file.yaml`. <br>**Note:** Each occurrence of `--log` and `--log-config-file` on the command line overrides the configuration set from previous occurrences. [#64948][#64948] {% comment %}doc{% endcomment %}
- The prefixes displayed before connection URLs when [`cockroach demo`](../v21.1/cockroach-demo.html) starts up have been updated to better align with the output of [`cockroach start`](../v21.1/cockroach-start.html). [#63535][#63535] {% comment %}doc{% endcomment %}
- The flag `--empty` for `cockroach demo` has been renamed to `--no-example-database`. `--empty` is still recognized but is marked as deprecated. Additionally, the user can now set the environment variable `COCKROACH_NO_EXAMPLE_DATABASE` to obtain this behavior automatically in every new demo session. [#63535][#63535] {% comment %}doc{% endcomment %}
- CockroachDB no longer supports the `\demo add` and `\demo shutdown` commands for `cockroach demo` in `--global` configurations. [#63535][#63535] {% comment %}doc{% endcomment %}
- Added a note when starting up a `--global` demo cluster that the `--global` configuration is experimental. [#63535][#63535] {% comment %}doc{% endcomment %}
- The SQL shell (`cockroach demo`, [`cockroach sql`](../v21.1/cockroach-sql.html)) now attempts to better format values that are akin to time/date values, as well as floating-point numbers. [#63541][#63541] {% comment %}doc{% endcomment %}
- [`cockroach debug zip`](../v21.1/cockroach-debug-zip.html) now attempts to pull data from multiple nodes concurrently, up to 15 nodes at a time. This change is meant to accelerate the data collection when a cluster contains multiple nodes. This behavior can be changed with the new command-line flag `--concurrency`. [#64705][#64705] {% comment %}doc{% endcomment %}
- The format of the informational messages printed by `cockroach debug zip` , when concurrent execution is enabled. [#64705][#64705] {% comment %}doc{% endcomment %}
- The new command `cockroach debug list-files` show the list of files that can be retrieved via the `cockroach debug zip` command. It supports the `--nodes` and `--exclude-nodes` parameters in the same way as `cockroach debug zip`. [#64705][#64705] {% comment %}doc{% endcomment %}
- It is now possible to fine-tune which files get retrieved from the server nodes by the `cockroach debug zip` command, using the new flag `--include-files` and `--exclude-files`. These flags take glob patterns that are applied to the file names server-side. For example, to include only log files, use `--include-files='*.log'`.  The command `cockroach debug list-files` also accepts these flags and can thus be used to experiment with the new flags before running the `cockroach debug zip` command. [#64705][#64705] {% comment %}doc{% endcomment %}
- The `cockroach debug zip` command now retrieves only the log files, goroutine dumps and heap profiles pertaining to the last 48 hours prior to the command invocation.  This behavior is supported entirely client-side, which means that it is not necessary to upgrade the server nodes to put these newly-configurable limits in place.  The other data items retrieved by `cockroach debug zip` are not affected by this time limit.  This behavior can be customized by the two new flags `--files-from` and `--files-until`. Both are optional. See the command-line help text for details.  The two new flags are also supported by `cockroach debug list-files`. It is advised to experiment with `list-files` prior to issuing a `debug zip` command that may retrieve a large amount of data. [#64705][#64705] {% comment %}doc{% endcomment %}

### DB Console changes

- A [new metric](../v21.1/ui-overview.html) for the average number of runnable goroutines per CPU is now present in the runtime graphs. [#64750][#64750] {% comment %}doc{% endcomment %}
- The Console now uses a new library for line graphs that renders metrics more efficiently. Customers with large clusters can now load and interact with metrics much faster than before. [#64479][#64479]
- Placed a legend under charts on [metrics page](../v21.1/ui-overview-dashboard.html), if more than 10 series are being displayed [#64479][#64479] {% comment %}doc{% endcomment %}

### Bug fixes

- Fixed a bug in the artificial latencies introduced by the `--global` flag to [`cockroach demo`](../v21.1/cockroach-demo.html). [#63535][#63535]
- Fixed a bug where multiple concurrent invocations of [`cockroach debug zip`](../v21.1/cockroach-debug-zip.html) could yield cluster instability. This bug had been present since CockroachDB v20.1. [#64083][#64083]
- When a [`STRING`](../v21.1/string.html) value is converted to [`TIME`](../v21.1/time.html)/[`DATE`](../v21.1/date.html)/[`TIMESTAMP`](../v21.1/timestamp.html), and the `STRING` value contains invalid entries, the error messages reported now more clearly report which fields are missing or undesired. [#63540][#63540]
- Fixed a bug where view expressions created using an [`ARRAY`](../v21.1/array.html) [`ENUM`](../v21.1/enum.html) without a name for the column could cause failures when dropping unrelated `ENUM` values. [#64272][#64272]
- Fixed a bug causing an internal error in rare circumstances when executing queries via the [vectorized engine](../v21.1/vectorized-execution.html) that operate on columns of [`BOOL`](../v21.1/bool.html), [`BYTES`](../v21.1/bytes.html), [`INT`](../v21.1/int.html), and [`FLOAT`](../v21.1/float.html) types that have a mix of [`NULL`](../v21.1/null-handling.html) and non-`NULL` values. [#62915][#62915]
- Fixed a bug causing CockroachDB to either return an error or crash when comparing an infinite `DATE` coming from a subquery against a `TIMESTAMP`. [#64074][#64074]
- CockroachDB now should crash less often due to out-of-memory conditions caused by the [subqueries](../v21.1/subqueries.html) returning multiple rows of large size. [#64727][#64727]
- Previously, the [session trace](../v21.1/show-trace.html) could contain entries that corresponded to the previous trace (i.e., `SET TRACING=ON` didn't properly reset the trace). Now this is fixed. [#64945][#64945]
- Previously, CockroachDB could incorrectly cast [integers](../v21.1/int.html) of larger widths to integers of smaller widths (e.g., `INT8` to `INT2`) when the former was out of range for the latter. Now this is fixed. [#65035][#65035]
- Fixed a race condition where read-write requests during replica removal (e.g., during range merges or rebalancing) could be evaluated on the removed replica. [#64598][#64598]
- [`BACKUP`](../v21.1/backup.html) no longer resolves intents one-by-one. This eliminates the need to run a high-priority query to cleanup intents to unblock `BACKUP` in the case of intent buildup. [#64881][#64881]
- Fixed an internal error that could occur during planning when a query used the output of an [`UPDATE`](../v21.1/update.html)'s `RETURNING` clause, and one or more of the columns in the `RETURNING` clause were from a table specified in the `FROM` clause of the `UPDATE` (i.e., not from the table being updated). [#62960][#62960]
- Fixed an index-out-of-range error that could occur when `crdb_internal_mvcc_timestamp` was selected as part of a [`view`](../v21.1/views.html). It is now possible to select `crdb_internal_mvcc_timestamp` as part of a view as long as it is aliased with a different name. [#63632][#63632]
- Fixed a bug in the application of environment variables to populate defaults for certain [command-line flags](../v21.1/cockroach-commands.html), for example `COCKROACH_URL` for `--url`, has been fixed. [#63539][#63539]
- Fixed a stack overflow that can happen in some corner cases involving [partial indexes](../v21.1/partial-indexes.html) with predicates containing `(x IS NOT NULL)`. [#64738][#64738]
- Providing a constant value as an [`ORDER BY`](../v21.1/order-by.html) value in an ordered-set [aggregate](../v21.1/functions-and-operators.html#aggregate-functions), such as `percentile_dist` or `percentile_cont`, no longer returns an error. This bug has been present since order-set aggregates were added in version 20.2. [#64902][#64902]
- Queries that reference tables with [`GEOMETRY` or `GEOGRAPHY`](../v21.1/spatial-glossary.html#data-types) [inverted indexes](../v21.1/inverted-indexes.html) and that call [geospatial functions](../v21.1/functions-and-operators.html#spatial-functions) with constant [`NULL`](../v21.1/null-handling.html) values cast to a type, like `NULL::GEOMETRY` or `NULL::FLOAT8`, no longer error. This bug was present since 20.2. [#63003][#63003]
- Fixed a bug causing CockroachDB to incorrectly calculate the latency from the remote nodes when the latency info was shown on the [`EXPLAIN ANALYZE (DISTSQL)`](../v21.1/explain-analyze.html) diagrams. [#63089][#63089]
- Fixed a bug causing the [`ZONECONFIG` privilege](../v21.1/authorization.html#privileges) on tables and databases to be incorrectly interpreted as `USAGE`, which could corrupt a table and/or database because `USAGE` is an invalid privilege for tables and databases. [#65160][#65160]
- Fixed a bug which could cause a panic when running an `EXECUTE` of a previously-prepared statement with a `REGCLASS` or `REGTYPE` parameter or a [user-defined type](../v21.1/enum.html) argument after running [`BEGIN AS OF SYSTEM TIME`](../v21.1/as-of-system-time.html) with an invalid timestamp. [#65150][#65150]
- Fixed a bug which could cause a panic when issuing a query referencing a [user-defined type](../v21.1/enum.html) as a placeholder. [#65150][#65150]
- Fixed a bug introduced in 20.2 that caused rows to be incorrectly de-duplicated from a scan with a non-unique index. [#65284][#65284]
- Fixed a bug where interval math on a [`TIMESTAMPTZ`](../v21.1/timestamp.html) value on a DST boundary would incorrectly add or subtract an extra hour. [#65095][#65095]
- Fixed a bug where `date_trunc` on a [`TIME`](../v21.1/time.html) value on a DST boundary could switch timezones and produce the incorrect result. [#65095][#65095]
- Improved memory utilization under some write-heavy workloads, added better logging to [storage engine](../v21.1/architecture/storage-layer.html) to surface compaction type, and persisted previously-missing Pebble options in `OPTIONS` file. [#65308][#65308]
- Fixed a bug causing `revision_history` cluster [backups](../v21.1/backup.html) to not include dropped databases. This means that, previously, dropped databases could not be restored from backups that were taken after the database was dropped. [#65314][#65314]
- Fixed a bug causing [`SHOW CREATE TABLE`](../v21.1/show-create.html) output to not display the [zone configurations](../v21.1/configure-zone.html) of a table or index if there were no partitions, even if there were zone configurations on the index or table. [#65176][#65176]
- Previously, concatenating a non-[`STRING`](../v21.1/string.html) value with a `STRING` value would not use the normal `STRING` representation of the non-`STRING` value. Now it does, so `true || 'string'` returns `truestring` instead of `tstring`. [#65331][#65331]
- Large [`SELECT FOR UPDATE`](../v21.1/selection-queries.html) scans will no longer prevent the memory associated with their entire result set from being reclaimed by the Go garbage collector for the lifetime of the locks that they acquire. [#65359][#65359]
- Fixed a rare race that could lead to a 3-second stall before a [Raft leader](../v21.1/architecture/replication-layer.html) was elected on a Range immediately after it was split off from its left-hand neighbor. [#65356][#65356]
- Fixed a bug where `SHOW CREATE TABLE` would show the zone configurations of a table of the same name from a different schema. [#65368][#65368]
- [`BACKUP`](../v21.1/backup.html), [`RESTORE`](../v21.1/restore.html), and [`IMPORT`](../v21.1/import.html) are now more resilient to node failures and will retry automatically. [#65391][#65391]
- Previously, replica rebalancing could sometimes rebalance to stores on dead nodes. This bug is now fixed. [#65428][#65428]

### Performance improvements

- The optimizer now always prefers to plan a [locality-optimized](../v21.1/multiregion-overview.html) scan over a regular scan when possible. This may enable the execution engine to avoid communicating with remote nodes, thus reducing query latency. [#65088][#65088]
- The optimizer will now try to plan anti lookup joins using "locality-optimized search". This optimization applies for anti lookup joins into [`REGIONAL BY ROW`](../v21.1/multiregion-overview.html#regional-by-row-tables) tables (i.e., the right side of the join is a `REGIONAL BY ROW` table), and if enabled, it means that the execution engine will first search locally for matching rows before searching remote nodes. If a matching row is found in a local node, remote nodes will not be searched. This optimization may improve the performance of [foreign key](../v21.1/foreign-key.html) checks when rows are inserted or updated in a table that references a foreign key in a `REGIONAL BY ROW` table. [#63118][#63118]
- Certain queries containing `<tuple> IN (<subquery>)` conditions now run faster. [#63866][#63866]
- Improved intent cleanup performance for aborted transactions. [#64588][#64588]
- Adjusted the estimated cost of locality-optimized anti joins in the optimizer so that they are always chosen over non-locality-optimized anti joins when possible. This makes it more likely that queries involving anti joins (such as inserts with foreign key checks) can avoid visiting remote regions. This results in lower latency. [#65131][#65131]
- The optimizer can now avoid full table scans for queries with a `LIMIT` and [`ORDER BY`](../v21.1/order-by.html) clause, where the `ORDER BY` columns form a prefix on an index in a `REGIONAL BY ROW` table (excluding the hidden `crdb_region` column). Instead of a full table scan, at most `LIMIT` rows are scanned per region. [#65287][#65287]

### Contributors

This release includes 100 merged PRs by 33 authors.
We would like to thank the following contributors from the CockroachDB community:

- Kumar Akshay
- Mohammad Aziz (first-time contributor)
- kurokochin (first-time contributor)

[#62915]: https://github.com/cockroachdb/cockroach/pull/62915
[#62960]: https://github.com/cockroachdb/cockroach/pull/62960
[#63003]: https://github.com/cockroachdb/cockroach/pull/63003
[#63089]: https://github.com/cockroachdb/cockroach/pull/63089
[#63118]: https://github.com/cockroachdb/cockroach/pull/63118
[#63535]: https://github.com/cockroachdb/cockroach/pull/63535
[#63539]: https://github.com/cockroachdb/cockroach/pull/63539
[#63540]: https://github.com/cockroachdb/cockroach/pull/63540
[#63541]: https://github.com/cockroachdb/cockroach/pull/63541
[#63632]: https://github.com/cockroachdb/cockroach/pull/63632
[#63866]: https://github.com/cockroachdb/cockroach/pull/63866
[#63880]: https://github.com/cockroachdb/cockroach/pull/63880
[#63881]: https://github.com/cockroachdb/cockroach/pull/63881
[#64074]: https://github.com/cockroachdb/cockroach/pull/64074
[#64083]: https://github.com/cockroachdb/cockroach/pull/64083
[#64272]: https://github.com/cockroachdb/cockroach/pull/64272
[#64479]: https://github.com/cockroachdb/cockroach/pull/64479
[#64588]: https://github.com/cockroachdb/cockroach/pull/64588
[#64589]: https://github.com/cockroachdb/cockroach/pull/64589
[#64598]: https://github.com/cockroachdb/cockroach/pull/64598
[#64705]: https://github.com/cockroachdb/cockroach/pull/64705
[#64727]: https://github.com/cockroachdb/cockroach/pull/64727
[#64738]: https://github.com/cockroachdb/cockroach/pull/64738
[#64750]: https://github.com/cockroachdb/cockroach/pull/64750
[#64881]: https://github.com/cockroachdb/cockroach/pull/64881
[#64902]: https://github.com/cockroachdb/cockroach/pull/64902
[#64945]: https://github.com/cockroachdb/cockroach/pull/64945
[#64948]: https://github.com/cockroachdb/cockroach/pull/64948
[#65035]: https://github.com/cockroachdb/cockroach/pull/65035
[#65047]: https://github.com/cockroachdb/cockroach/pull/65047
[#65088]: https://github.com/cockroachdb/cockroach/pull/65088
[#65095]: https://github.com/cockroachdb/cockroach/pull/65095
[#65098]: https://github.com/cockroachdb/cockroach/pull/65098
[#65131]: https://github.com/cockroachdb/cockroach/pull/65131
[#65150]: https://github.com/cockroachdb/cockroach/pull/65150
[#65160]: https://github.com/cockroachdb/cockroach/pull/65160
[#65176]: https://github.com/cockroachdb/cockroach/pull/65176
[#65284]: https://github.com/cockroachdb/cockroach/pull/65284
[#65287]: https://github.com/cockroachdb/cockroach/pull/65287
[#65308]: https://github.com/cockroachdb/cockroach/pull/65308
[#65314]: https://github.com/cockroachdb/cockroach/pull/65314
[#65331]: https://github.com/cockroachdb/cockroach/pull/65331
[#65334]: https://github.com/cockroachdb/cockroach/pull/65334
[#65345]: https://github.com/cockroachdb/cockroach/pull/65345
[#65356]: https://github.com/cockroachdb/cockroach/pull/65356
[#65357]: https://github.com/cockroachdb/cockroach/pull/65357
[#65358]: https://github.com/cockroachdb/cockroach/pull/65358
[#65359]: https://github.com/cockroachdb/cockroach/pull/65359
[#65361]: https://github.com/cockroachdb/cockroach/pull/65361
[#65363]: https://github.com/cockroachdb/cockroach/pull/65363
[#65368]: https://github.com/cockroachdb/cockroach/pull/65368
[#65391]: https://github.com/cockroachdb/cockroach/pull/65391
[#65428]: https://github.com/cockroachdb/cockroach/pull/65428
[#65442]: https://github.com/cockroachdb/cockroach/pull/65442
